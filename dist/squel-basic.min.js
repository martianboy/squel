/*! squel | https://github.com/hiddentao/squel | BSD license */!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.squel=e()}(this,function(){"use strict";function l(t,e,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=y(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function v(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?d(t):e}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){return t.length?t+e:t}function h(n){for(var t=arguments.length,e=new Array(1<t?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];if(n&&e)for(var i=function(){var e=o[a];"object"===c(e)&&Object.getOwnPropertyNames(e).forEach(function(t){n[t]=e[t]})},a=0,o=e;a<o.length;a++)i();return n}function o(t){return t&&t.constructor.prototype===Object.prototype}function m(t){return t&&t.constructor.prototype===Array.prototype}function u(t,e,n){var r=c(e);if("function"!==r&&"string"!==r)throw new Error("type must be a class constructor or string");if("function"!=typeof n)throw new Error("handler must be a function");var i=!0,a=!1,o=void 0;try{for(var l,u=t[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var s=l.value;if(s.type===e)return void(s.handler=n)}}catch(t){a=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}t.push({type:e,handler:n})}function f(t,e,n){return s(t,e)||s(t,n)}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(c(t)===r.type||"string"!=typeof r.type&&t instanceof r.type)return r.handler}}function p(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,p={isSquelBuilder:function(t){return t&&!!t._toParamString}},s=function(t){return!p.isSquelBuilder(t)||!t.options.rawNesting};p.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" ",stringFormatter:null,rawNesting:!1},p.globalValueHandlers=[],p.registerValueHandler=function(t,e){u(p.globalValueHandlers,t,e)},p.Cloneable=function(){function t(){g(this,t)}return a(t,[{key:"clone",value:function(){return h(new this.constructor,function e(n){if(!n)return n;if("function"==typeof n.clone)return n.clone();if(o(n)||m(n)){var r=new n.constructor;return Object.getOwnPropertyNames(n).forEach(function(t){"function"!=typeof n[t]&&(r[t]=e(n[t]))}),r}return JSON.parse(JSON.stringify(n))}(h({},this)))}}]),t}(),p.BaseBuilder=function(t){function r(t){var e;g(this,r),e=v(this,y(r).call(this));var n=JSON.parse(JSON.stringify(p.DefaultQueryBuilderOptions));return["stringFormatter"].forEach(function(t){n[t]=p.DefaultQueryBuilderOptions[t]}),e.options=h({},n,t),e}return i(r,p.Cloneable),a(r,[{key:"registerValueHandler",value:function(t,e){return u(this.options.valueHandlers,t,e),this}},{key:"_sanitizeExpression",value:function(t){if(!p.isSquelBuilder(t)&&"string"!=typeof t)throw new Error("expression must be a stringÂ or builder instance");return t}},{key:"_sanitizeName",value:function(t,e){if("string"!=typeof t)throw new Error("".concat(e," must be a string"));return t}},{key:"_sanitizeField",value:function(t){return p.isSquelBuilder(t)||(t=this._sanitizeName(t,"field name")),t}},{key:"_sanitizeBaseBuilder",value:function(t){if(p.isSquelBuilder(t))return t;throw new Error("must be a builder instance")}},{key:"_sanitizeTable",value:function(t){if("string"!=typeof t)try{t=this._sanitizeBaseBuilder(t)}catch(t){throw new Error("table name must be a string or a builder")}else t=this._sanitizeName(t,"table");return t}},{key:"_sanitizeTableAlias",value:function(t){return this._sanitizeName(t,"table alias")}},{key:"_sanitizeFieldAlias",value:function(t){return this._sanitizeName(t,"field alias")}},{key:"_sanitizeLimitOffset",value:function(t){if((t=parseInt(t))<0||isNaN(t))throw new Error("limit/offset must be >= 0");return t}},{key:"_sanitizeValue",value:function(t){var e=c(t);if(null===t);else if("string"===e||"number"===e||"boolean"===e);else if(p.isSquelBuilder(t));else{if(!!!f(t,this.options.valueHandlers,p.globalValueHandlers))throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return t}},{key:"_escapeValue",value:function(t){return this.options.replaceSingleQuotes&&t?t.replace(/\'/g,this.options.singleQuoteReplacement):t}},{key:"_formatTableName",value:function(t){if(this.options.autoQuoteTableNames){var e=this.options.nameQuoteCharacter;t="".concat(e).concat(t).concat(e)}return t}},{key:"_formatFieldAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.fieldAliasQuoteCharacter;t="".concat(e).concat(t).concat(e)}return t}},{key:"_formatTableAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.tableAliasQuoteCharacter;t="".concat(e).concat(t).concat(e)}return this.options.useAsForTableAliasNames?"AS ".concat(t):t}},{key:"_formatFieldName",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(this.options.autoQuoteFieldNames){var n=this.options.nameQuoteCharacter;t=e.ignorePeriodsForFieldNameQuotes?"".concat(n).concat(t).concat(n):t.split(".").map(function(t){return"*"===t?t:"".concat(n).concat(t).concat(n)}).join(".")}return t}},{key:"_formatCustomValue",value:function(t,e,n){var r=f(t,this.options.valueHandlers,p.globalValueHandlers);return r&&(t=r(t,e,n))&&t.rawNesting?{formatted:!0,rawNesting:!0,value:t.value}:{formatted:!!r,value:t}}},{key:"_formatValueForParamArray",value:function(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return m(t)?t.map(function(t){return e._formatValueForParamArray(t,n)}):this._formatCustomValue(t,!0,n).value}},{key:"_formatValueForQueryString",value:function(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=this._formatCustomValue(t,!1,n),i=r.rawNesting,a=r.formatted,o=r.value;if(a)return i?o:this._applyNestingFormatting(o,s(t));if(m(o))o=o.map(function(t){return e._formatValueForQueryString(t)}),o=this._applyNestingFormatting(o.join(", "),s(o));else{var l=c(o);if(null===o)o="NULL";else if("boolean"===l)o=o?"TRUE":"FALSE";else if(p.isSquelBuilder(o))o=this._applyNestingFormatting(o.toString(),s(o));else if("number"!==l){if("string"===l&&this.options.stringFormatter)return this.options.stringFormatter(o);if(n.dontQuote)o="".concat(o);else{var u=this._escapeValue(o);o="'".concat(u,"'")}}}return o}},{key:"_applyNestingFormatting",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(t&&"string"==typeof t&&e&&!this.options.rawNesting){var n="("===t.charAt(0)&&")"===t.charAt(t.length-1);if(n)for(var r=0,i=1;t.length-1>++r;){var a=t.charAt(r);if("("===a)i++;else if(")"===a&&--i<1){n=!1;break}}n||(t="(".concat(t,")"))}return t}},{key:"_buildString",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=n.nested,i=n.buildParameterized,a=n.formattingOptions;e=e||[],t=t||"";for(var o="",l=-1,u=[],s=this.options.parameterCharacter,c=0;t.length>c;)if(t.substr(c,s.length)===s){var h=e[++l];if(i)if(p.isSquelBuilder(h)){var f=h._toParamString({buildParameterized:i,nested:!0});o+=f.text,f.values.forEach(function(t){return u.push(t)})}else if(m(h=this._formatValueForParamArray(h,a))){var v=h.map(function(){return s}).join(", ");o+="(".concat(v,")"),h.forEach(function(t){return u.push(t)})}else o+=s,u.push(h);else o+=this._formatValueForQueryString(h,a);c+=s.length}else o+=t.charAt(c),c++;return{text:this._applyNestingFormatting(o,!!r),values:u}}},{key:"_buildManyStrings",value:function(t,e){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=[],i=[],a=0;t.length>a;++a){var o=t[a],l=e[a],u=this._buildString(o,l,{buildParameterized:n.buildParameterized,nested:!1}),s=u.text,c=u.values;r.push(s),c.forEach(function(t){return i.push(t)})}return{text:(r=r.join(this.options.separator)).length?this._applyNestingFormatting(r,!!n.nested):"",values:i}}},{key:"_toParamString",value:function(t){throw new Error("Not yet implemented")}},{key:"toString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._toParamString(t).text}},{key:"toParam",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._toParamString(h({},t,{buildParameterized:!0}))}}]),r}(),p.Expression=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._nodes=[],e}return i(n,p.BaseBuilder),a(n,[{key:"and",value:function(t){t=this._sanitizeExpression(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this._nodes.push({type:"AND",expr:t,para:n}),this}},{key:"or",value:function(t){t=this._sanitizeExpression(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this._nodes.push({type:"OR",expr:t,para:n}),this}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=[],n=[],r=!0,i=!1,a=void 0;try{for(var o,l=this._nodes[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value,s=u.type,c=u.expr,h=u.para,f=p.isSquelBuilder(c)?c._toParamString({buildParameterized:t.buildParameterized,nested:!0}):this._buildString(c,h,{buildParameterized:t.buildParameterized}),v=f.text,d=f.values;e.length&&e.push(s),e.push(v),d.forEach(function(t){return n.push(t)})}}catch(t){i=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return e=e.join(" "),{text:this._applyNestingFormatting(e,!!t.nested),values:n}}}]),n}(),p.Case=function(t){function r(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return g(this,r),e=v(this,y(r).call(this,n)),o(t)&&(n=t,t=null),t&&(e._fieldName=e._sanitizeField(t)),e.options=h({},p.DefaultQueryBuilderOptions,n),e._cases=[],e._elseValue=null,e}return i(r,p.BaseBuilder),a(r,[{key:"when",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return this._cases.unshift({expression:t,values:n||[]}),this}},{key:"then",value:function(t){if(0==this._cases.length)throw new Error("when() needs to be called first");return this._cases[0].result=t,this}},{key:"else",value:function(t){return this._elseValue=t,this}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],r=!0,i=!1,a=void 0;try{for(var o,l=this._cases[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value,s=u.expression,c=u.values,h=u.result;e=_(e," ");var f=this._buildString(s,c,{buildParameterized:t.buildParameterized,nested:!0});e+="WHEN ".concat(f.text," THEN ").concat(this._formatValueForQueryString(h)),f.values.forEach(function(t){return n.push(t)})}}catch(t){i=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return{text:e=e.length?(e+=" ELSE ".concat(this._formatValueForQueryString(this._elseValue)," END"),this._fieldName&&(e="".concat(this._fieldName," ").concat(e)),"CASE ".concat(e)):this._formatValueForQueryString(this._elseValue),values:n}}}]),r}(),p.Block=function(t){function e(t){return g(this,e),v(this,y(e).call(this,t))}return i(e,p.BaseBuilder),a(e,[{key:"exposedMethods",value:function(){for(var e={},n=this;n;)Object.getOwnPropertyNames(n).forEach(function(t){"constructor"===t||"function"!=typeof n[t]||"_"===t.charAt(0)||p.Block.prototype[t]||(e[t]=n[t])}),n=Object.getPrototypeOf(n);return e}}]),e}(),p.StringBlock=function(t){function r(t,e){var n;return g(this,r),(n=v(this,y(r).call(this,t)))._str=e,n}return i(r,p.Block),a(r,[{key:"_toParamString",value:function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];return{text:this._str,values:[]}}}]),r}(),p.FunctionBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._strings=[],e._values=[],e}return i(n,p.Block),a(n,[{key:"function",value:function(t){this._strings.push(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this._values.push(n)}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._buildManyStrings(this._strings,this._values,t)}}]),n}(),p.registerValueHandler(p.FunctionBlock,function(t){return 1<arguments.length&&void 0!==arguments[1]&&arguments[1]?t.toParam():t.toString()}),p.AbstractTableBlock=function(t){function r(t,e){var n;return g(this,r),(n=v(this,y(r).call(this,t)))._tables=[],n}return i(r,p.Block),a(r,[{key:"_table",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e=e?this._sanitizeTableAlias(e):e,t=this._sanitizeTable(t),this.options.singleTable&&(this._tables=[]),this._tables.push({table:t,alias:e})}},{key:"_hasTable",value:function(){return 0<this._tables.length}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[];if(this._hasTable()){var r=!0,i=!1,a=void 0;try{for(var o,l=this._tables[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value,s=u.table,c=u.alias;e=_(e,", ");var h=void 0;if(p.isSquelBuilder(s)){var f=s._toParamString({buildParameterized:t.buildParameterized,nested:!0}),v=f.text,d=f.values;h=v,d.forEach(function(t){return n.push(t)})}else h=this._formatTableName(s);c&&(h+=" ".concat(this._formatTableAlias(c))),e+=h}}catch(t){i=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}this.options.prefix&&(e="".concat(this.options.prefix," ").concat(e))}return{text:e,values:n}}}]),r}(),p.TargetTableBlock=function(t){function e(){return g(this,e),v(this,y(e).apply(this,arguments))}return i(e,p.AbstractTableBlock),a(e,[{key:"target",value:function(t){this._table(t)}}]),e}(),p.UpdateTableBlock=function(t){function e(){return g(this,e),v(this,y(e).apply(this,arguments))}return i(e,p.AbstractTableBlock),a(e,[{key:"table",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._table(t,e)}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this._hasTable())throw new Error("table() needs to be called");return l(y(e.prototype),"_toParamString",this).call(this,t)}}]),e}(),p.FromTableBlock=function(t){function e(t){return g(this,e),v(this,y(e).call(this,h({},t,{prefix:"FROM"})))}return i(e,p.AbstractTableBlock),a(e,[{key:"from",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._table(t,e)}}]),e}(),p.IntoTableBlock=function(t){function e(t){return g(this,e),v(this,y(e).call(this,h({},t,{prefix:"INTO",singleTable:!0})))}return i(e,p.AbstractTableBlock),a(e,[{key:"into",value:function(t){this._table(t)}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this._hasTable())throw new Error("into() needs to be called");return l(y(e.prototype),"_toParamString",this).call(this,t)}}]),e}(),p.GetFieldBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._fields=[],e}return i(n,p.Block),a(n,[{key:"fields",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(m(t)){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var l=a.value;this.field(l,null,e)}}catch(t){r=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}else for(var u in t){var s=t[u];this.field(u,s,e)}}},{key:"field",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(n=n?this._sanitizeFieldAlias(n):n,e=this._sanitizeField(e),this._fields.filter(function(t){return t.name===e&&t.alias===n}).length)return this;this._fields.push({name:e,alias:n,options:t})}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.queryBuilder,n=t.buildParameterized,r="",i=[],a=!0,o=!1,l=void 0;try{for(var u,s=this._fields[Symbol.iterator]();!(a=(u=s.next()).done);a=!0){var c=u.value;r=_(r,", ");var h=c.name,f=c.alias,v=c.options;if("string"==typeof h)r+=this._formatFieldName(h,v);else{var d=h._toParamString({nested:!0,buildParameterized:n});r+=d.text,d.values.forEach(function(t){return i.push(t)})}f&&(r+=" AS ".concat(this._formatFieldAlias(f)))}}catch(t){o=!0,l=t}finally{try{a||null==s.return||s.return()}finally{if(o)throw l}}if(!r.length){var y=e&&e.getBlock(p.FromTableBlock);y&&y._hasTable()&&(r="*")}return{text:r,values:i}}}]),n}(),p.AbstractSetFieldBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._reset(),e}return i(n,p.Block),a(n,[{key:"_reset",value:function(){this._fields=[],this._values=[[]],this._valueOptions=[[]]}},{key:"_set",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(1<this._values.length)throw new Error("Cannot set multiple rows of fields this way.");void 0!==e&&(e=this._sanitizeValue(e)),t=this._sanitizeField(t);var r=this._fields.indexOf(t);-1===r&&(this._fields.push(t),r=this._fields.length-1),this._values[0][r]=e,this._valueOptions[0][r]=n}},{key:"_setFields",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("object"!==c(t))throw new Error("Expected an object but got "+c(t));for(var n in t)this._set(n,t[n],e)}},{key:"_setFieldsRows",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!m(t))throw new Error("Expected an array of objects but got "+c(t));this._reset();for(var n=0;t.length>n;++n){var r=t[n];for(var i in r){var a=r[i];i=this._sanitizeField(i),a=this._sanitizeValue(a);var o=this._fields.indexOf(i);if(0<n&&-1===o)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===o&&(this._fields.push(i),o=this._fields.length-1),m(this._values[n])||(this._values[n]=[],this._valueOptions[n]=[]),this._values[n][o]=a,this._valueOptions[n][o]=e}}}}]),n}(),p.SetFieldBlock=function(t){function e(){return g(this,e),v(this,y(e).apply(this,arguments))}return i(e,p.AbstractSetFieldBlock),a(e,[{key:"set",value:function(t,e,n){this._set(t,e,n)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"_toParamString",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).buildParameterized;if(this._fields.length<=0)throw new Error("set() needs to be called");for(var e="",n=[],r=0;r<this._fields.length;++r){e=_(e,", ");var i=this._formatFieldName(this._fields[r]),a=this._values[0][r];i.indexOf("=")<0&&(i="".concat(i," = ").concat(this.options.parameterCharacter));var o=this._buildString(i,[a],{buildParameterized:t,formattingOptions:this._valueOptions[0][r]});e+=o.text,o.values.forEach(function(t){return n.push(t)})}return{text:"SET ".concat(e),values:n}}}]),e}(),p.InsertFieldValueBlock=function(t){function e(){return g(this,e),v(this,y(e).apply(this,arguments))}return i(e,p.AbstractSetFieldBlock),a(e,[{key:"set",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this._set(t,e,n)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"setFieldsRows",value:function(t,e){this._setFieldsRows(t,e)}},{key:"_toParamString",value:function(){for(var e=this,t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).buildParameterized,n=this._fields.map(function(t){return e._formatFieldName(t)}).join(", "),r=[],i=[],a=0;a<this._values.length;++a){r[a]="";for(var o=0;o<this._values[a].length;++o){var l=this._buildString(this.options.parameterCharacter,[this._values[a][o]],{buildParameterized:t,formattingOptions:this._valueOptions[a][o]});l.values.forEach(function(t){return i.push(t)}),r[a]=_(r[a],", "),r[a]+=l.text}}return{text:n.length?"(".concat(n,") VALUES (").concat(r.join("), ("),")"):"",values:i}}}]),e}(),p.InsertFieldsFromQueryBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._fields=[],e._query=null,e}return i(n,p.Block),a(n,[{key:"fromQuery",value:function(t,e){var n=this;this._fields=t.map(function(t){return n._sanitizeField(t)}),this._query=this._sanitizeBaseBuilder(e)}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[];if(this._fields.length&&this._query){var r=this._query._toParamString({buildParameterized:t.buildParameterized,nested:!0}),i=r.text,a=r.values;e="(".concat(this._fields.join(", "),") ").concat(this._applyNestingFormatting(i)),n=a}return{text:e,values:n}}}]),n}(),p.DistinctBlock=function(t){function e(){return g(this,e),v(this,y(e).apply(this,arguments))}return i(e,p.Block),a(e,[{key:"distinct",value:function(){this._useDistinct=!0}},{key:"_toParamString",value:function(){return{text:this._useDistinct?"DISTINCT":"",values:[]}}}]),e}(),p.GroupByBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._groups=[],e}return i(n,p.Block),a(n,[{key:"group",value:function(t){this._groups.push(this._sanitizeField(t))}},{key:"_toParamString",value:function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];return{text:this._groups.length?"GROUP BY ".concat(this._groups.join(", ")):"",values:[]}}}]),n}(),p.AbstractVerbSingleValueBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._value=null,e}return i(n,p.Block),a(n,[{key:"_setValue",value:function(t){this._value=null!==t?this._sanitizeLimitOffset(t):t}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=null!==this._value?"".concat(this.options.verb," ").concat(this.options.parameterCharacter):"",n=null!==this._value?[this._value]:[];return this._buildString(e,n,t)}}]),n}(),p.OffsetBlock=function(t){function e(t){return g(this,e),v(this,y(e).call(this,h({},t,{verb:"OFFSET"})))}return i(e,p.AbstractVerbSingleValueBlock),a(e,[{key:"offset",value:function(t){this._setValue(t)}}]),e}(),p.LimitBlock=function(t){function e(t){return g(this,e),v(this,y(e).call(this,h({},t,{verb:"LIMIT"})))}return i(e,p.AbstractVerbSingleValueBlock),a(e,[{key:"limit",value:function(t){this._setValue(t)}}]),e}(),p.AbstractConditionBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._conditions=[],e}return i(n,p.Block),a(n,[{key:"_condition",value:function(t){t=this._sanitizeExpression(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this._conditions.push({expr:t,values:n||[]})}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=[],n=[],r=!0,i=!1,a=void 0;try{for(var o,l=this._conditions[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value,s=u.expr,c=u.values,h=p.isSquelBuilder(s)?s._toParamString({buildParameterized:t.buildParameterized}):this._buildString(s,c,{buildParameterized:t.buildParameterized});h.text.length&&e.push(h.text),h.values.forEach(function(t){return n.push(t)})}}catch(t){i=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return e.length&&(e=e.join(") AND (")),{text:e.length?"".concat(this.options.verb," (").concat(e,")"):"",values:n}}}]),n}(),p.WhereBlock=function(t){function e(t){return g(this,e),v(this,y(e).call(this,h({},t,{verb:"WHERE"})))}return i(e,p.AbstractConditionBlock),a(e,[{key:"where",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this._condition.apply(this,[t].concat(n))}}]),e}(),p.HavingBlock=function(t){function e(t){return g(this,e),v(this,y(e).call(this,h({},t,{verb:"HAVING"})))}return i(e,p.AbstractConditionBlock),a(e,[{key:"having",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this._condition.apply(this,[t].concat(n))}}]),e}(),p.OrderByBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._orders=[],e}return i(n,p.Block),a(n,[{key:"order",value:function(t,e){t=this._sanitizeField(t),"string"!=typeof e&&(void 0===e?e="ASC":null!==e&&(e=e?"ASC":"DESC"));for(var n=arguments.length,r=new Array(2<n?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];this._orders.push({field:t,dir:e,values:r||[]})}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],r=!0,i=!1,a=void 0;try{for(var o,l=this._orders[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value,s=u.field,c=u.dir,h=u.values;e=_(e,", ");var f=this._buildString(s,h,{buildParameterized:t.buildParameterized});e+=f.text,m(f.values)&&f.values.forEach(function(t){return n.push(t)}),null!==c&&(e+=" ".concat(c))}}catch(t){i=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return{text:e.length?"ORDER BY ".concat(e):"",values:n}}}]),n}(),p.JoinBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._joins=[],e}return i(n,p.Block),a(n,[{key:"join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"INNER";t=this._sanitizeTable(t,!0),e=e?this._sanitizeTableAlias(e):e,n=n?this._sanitizeExpression(n):n,this._joins.push({type:r,table:t,alias:e,condition:n})}},{key:"left_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"LEFT")}},{key:"right_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"RIGHT")}},{key:"outer_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"OUTER")}},{key:"left_outer_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"LEFT OUTER")}},{key:"full_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"FULL")}},{key:"cross_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"CROSS")}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],r=!0,i=!1,a=void 0;try{for(var o,l=this._joins[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value,s=u.type,c=u.table,h=u.alias,f=u.condition;e=_(e,this.options.separator);var v=void 0;if(p.isSquelBuilder(c)){var d=c._toParamString({buildParameterized:t.buildParameterized,nested:!0});d.values.forEach(function(t){return n.push(t)}),v=d.text}else v=this._formatTableName(c);if(e+="".concat(s," JOIN ").concat(v),h&&(e+=" ".concat(this._formatTableAlias(h))),f){e+=" ON ";var y=void 0;y=p.isSquelBuilder(f)?f._toParamString({buildParameterized:t.buildParameterized}):this._buildString(f,[],{buildParameterized:t.buildParameterized}),e+=this._applyNestingFormatting(y.text),y.values.forEach(function(t){return n.push(t)})}}}catch(t){i=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return{text:e,values:n}}}]),n}(),p.SetOpBlock=function(t){function n(t){var e;return g(this,n),(e=v(this,y(n).call(this,t)))._sets=[],e}return i(n,p.Block),a(n,[{key:"_add",value:function(t,e){t=this._sanitizeTable(t),this._sets.push({type:e,table:t})}},{key:"union",value:function(t){this._add(t,"UNION")}},{key:"union_all",value:function(t){this._add(t,"UNION ALL")}},{key:"intersect",value:function(t){this._add(t,"INTERSECT")}},{key:"intersect_all",value:function(t){this._add(t,"INTERSECT ALL")}},{key:"except",value:function(t){this._add(t,"EXCEPT")}},{key:"except_all",value:function(t){this._add(t,"EXCEPT ALL")}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],r=!0,i=!1,a=void 0;try{for(var o,l=this._sets[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value,s=u.type,c=u.table;e=_(e,this.options.separator);var h=void 0;if(c instanceof p.BaseBuilder){var f=c._toParamString({buildParameterized:t.buildParameterized,nested:!0});h=f.text,f.values.forEach(function(t){return n.push(t)})}else e=this._formatTableName(c);e+="".concat(s," ").concat(h)}}catch(t){i=!0,a=t}finally{try{r||null==l.return||l.return()}finally{if(i)throw a}}return{text:e,values:n}}}]),n}(),p.QueryBuilder=function(t){function f(t,e){var a;g(this,f),(a=v(this,y(f).call(this,t))).blocks=e||[];var n=!0,r=!1,i=void 0;try{for(var o,l=a.blocks[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var u=o.value,s=u.exposedMethods();for(var c in s){var h=s[c];if(void 0!==a[c])throw new Error("Builder already has a builder method called: ".concat(c));!function(r,t,i){a[c]=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return i.call.apply(i,[r].concat(e)),d(a)}}(u,0,h)}}}catch(t){r=!0,i=t}finally{try{n||null==l.return||l.return()}finally{if(r)throw i}}return a}return i(f,p.BaseBuilder),a(f,[{key:"registerValueHandler",value:function(t,e){var n=!0,r=!1,i=void 0;try{for(var a,o=this.blocks[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){a.value.registerValueHandler(t,e)}}catch(t){r=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return l(y(f.prototype),"registerValueHandler",this).call(this,t,e),this}},{key:"updateOptions",value:function(t){this.options=h({},this.options,t);var e=!0,n=!1,r=void 0;try{for(var i,a=this.blocks[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;o.options=h({},o.options,t)}}catch(t){n=!0,r=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"_toParamString",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};n=h({},this.options,n);var t=this.blocks.map(function(t){return t._toParamString({buildParameterized:n.buildParameterized,queryBuilder:e})}),r=t.map(function(t){return t.text}),i=t.map(function(t){return t.values}),a=r.filter(function(t){return 0<t.length}).join(n.separator),o=[];if(i.forEach(function(t){return t.forEach(function(t){return o.push(t)})}),!n.nested&&n.numberedParameters){var l=void 0!==n.numberedParametersStartAt?n.numberedParametersStartAt:1,u=n.parameterCharacter.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");a=a.replace(new RegExp(u,"g"),function(){return"".concat(n.numberedParametersPrefix).concat(l++)})}return{text:this._applyNestingFormatting(a,!!n.nested),values:o}}},{key:"clone",value:function(){var t=this.blocks.map(function(t){return t.clone()});return new this.constructor(this.options,t)}},{key:"getBlock",value:function(e){return this.blocks.filter(function(t){return t instanceof e})[0]}}]),f}(),p.Select=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return g(this,n),e=e||[new p.StringBlock(t,"SELECT"),new p.FunctionBlock(t),new p.DistinctBlock(t),new p.GetFieldBlock(t),new p.FromTableBlock(t),new p.JoinBlock(t),new p.WhereBlock(t),new p.GroupByBlock(t),new p.HavingBlock(t),new p.OrderByBlock(t),new p.LimitBlock(t),new p.OffsetBlock(t),new p.SetOpBlock(t)],v(this,y(n).call(this,t,e))}return i(n,p.QueryBuilder),n}(),p.Update=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return g(this,n),e=e||[new p.StringBlock(t,"UPDATE"),new p.UpdateTableBlock(t),new p.SetFieldBlock(t),new p.WhereBlock(t),new p.OrderByBlock(t),new p.LimitBlock(t)],v(this,y(n).call(this,t,e))}return i(n,p.QueryBuilder),n}(),p.Delete=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return g(this,n),e=e||[new p.StringBlock(t,"DELETE"),new p.TargetTableBlock(t),new p.FromTableBlock(h({},t,{singleTable:!0})),new p.JoinBlock(t),new p.WhereBlock(t),new p.OrderByBlock(t),new p.LimitBlock(t)],v(this,y(n).call(this,t,e))}return i(n,p.QueryBuilder),n}(),p.Insert=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return g(this,n),e=e||[new p.StringBlock(t,"INSERT"),new p.IntoTableBlock(t),new p.InsertFieldValueBlock(t),new p.InsertFieldsFromQueryBlock(t)],v(this,y(n).call(this,t,e))}return i(n,p.QueryBuilder),n}();var e={VERSION:"5.13.4",flavour:t,expr:function(t){return new p.Expression(t)},case:function(t,e){return new p.Case(t,e)},select:function(t,e){return new p.Select(t,e)},update:function(t,e){return new p.Update(t,e)},insert:function(t,e){return new p.Insert(t,e)},delete:function(t,e){return new p.Delete(t,e)},str:function(){var t=new p.FunctionBlock;return t.function.apply(t,arguments),t},rstr:function(){var t=new p.FunctionBlock({rawNesting:!0});return t.function.apply(t,arguments),t},registerValueHandler:p.registerValueHandler};return e.remove=e.delete,e.cls=p,e}var b=p();return b.flavours={},b.useFlavour=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(!t)return b;if(b.flavours[t]instanceof Function){var e=p(t);return b.flavours[t].call(null,e),e.flavours=b.flavours,e.useFlavour=b.useFlavour,e}throw new Error("Flavour not available: ".concat(t))},b});