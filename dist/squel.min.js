/*! squel | https://github.com/hiddentao/squel | BSD license */!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.squel=e()}(this,function(){"use strict";function o(t,e,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function v(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?d(t):e}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function u(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){return t.length?t+e:t}function h(n){for(var t=arguments.length,e=new Array(1<t?t-1:0),i=1;i<t;i++)e[i-1]=arguments[i];if(n&&e){var r=!0,a=!1,l=void 0;try{for(var o,u=function(){var e=o.value;"object"===c(e)&&Object.getOwnPropertyNames(e).forEach(function(t){n[t]=e[t]})},s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)u()}catch(t){a=!0,l=t}finally{try{r||null==s.return||s.return()}finally{if(a)throw l}}}return n}function r(t){return t&&t.constructor.prototype===Object.prototype}function m(t){return t&&t.constructor.prototype===Array.prototype}function a(t,e,n){var i=c(e);if("function"!==i&&"string"!==i)throw new Error("type must be a class constructor or string");if("function"!=typeof n)throw new Error("handler must be a function");var r=!0,a=!1,l=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var s=o.value;if(s.type===e)return void(s.handler=n)}}catch(t){a=!0,l=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw l}}t.push({type:e,handler:n})}function f(t,e,n){return s(t,e)||s(t,n)}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];if(c(t)===i.type||"string"!=typeof i.type&&t instanceof i.type)return i.handler}}function y(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,y={isSquelBuilder:function(t){return t&&!!t._toParamString}},s=function(t){return!y.isSquelBuilder(t)||!t.options.rawNesting};y.DefaultQueryBuilderOptions={autoQuoteTableNames:!1,autoQuoteFieldNames:!1,autoQuoteAliasNames:!0,useAsForTableAliasNames:!1,nameQuoteCharacter:"`",tableAliasQuoteCharacter:"`",fieldAliasQuoteCharacter:'"',valueHandlers:[],parameterCharacter:"?",numberedParameters:!1,numberedParametersPrefix:"$",numberedParametersStartAt:1,replaceSingleQuotes:!1,singleQuoteReplacement:"''",separator:" ",stringFormatter:null,rawNesting:!1},y.globalValueHandlers=[],y.registerValueHandler=function(t,e){a(y.globalValueHandlers,t,e)},y.Cloneable=function(){function t(){_(this,t)}return u(t,[{key:"clone",value:function(){return h(new this.constructor,function e(n){if(!n)return n;if("function"==typeof n.clone)return n.clone();if(r(n)||m(n)){var i=new n.constructor;return Object.getOwnPropertyNames(n).forEach(function(t){"function"!=typeof n[t]&&(i[t]=e(n[t]))}),i}return JSON.parse(JSON.stringify(n))}(h({},this)))}}]),t}(),y.BaseBuilder=function(t){function i(t){var e;_(this,i),e=v(this,p(i).call(this));var n=JSON.parse(JSON.stringify(y.DefaultQueryBuilderOptions));return["stringFormatter"].forEach(function(t){n[t]=y.DefaultQueryBuilderOptions[t]}),e.options=h({},n,t),e}return l(i,y.Cloneable),u(i,[{key:"registerValueHandler",value:function(t,e){return a(this.options.valueHandlers,t,e),this}},{key:"_sanitizeExpression",value:function(t){if(!y.isSquelBuilder(t)&&"string"!=typeof t)throw new Error("expression must be a stringÂ or builder instance");return t}},{key:"_sanitizeName",value:function(t,e){if("string"!=typeof t)throw new Error("".concat(e," must be a string"));return t}},{key:"_sanitizeField",value:function(t){return y.isSquelBuilder(t)||(t=this._sanitizeName(t,"field name")),t}},{key:"_sanitizeBaseBuilder",value:function(t){if(y.isSquelBuilder(t))return t;throw new Error("must be a builder instance")}},{key:"_sanitizeTable",value:function(t){if("string"!=typeof t)try{t=this._sanitizeBaseBuilder(t)}catch(t){throw new Error("table name must be a string or a builder")}else t=this._sanitizeName(t,"table");return t}},{key:"_sanitizeTableAlias",value:function(t){return this._sanitizeName(t,"table alias")}},{key:"_sanitizeFieldAlias",value:function(t){return this._sanitizeName(t,"field alias")}},{key:"_sanitizeLimitOffset",value:function(t){if((t=parseInt(t))<0||isNaN(t))throw new Error("limit/offset must be >= 0");return t}},{key:"_sanitizeValue",value:function(t){var e=c(t);if(null===t);else if("string"===e||"number"===e||"boolean"===e);else if(y.isSquelBuilder(t));else{if(!!!f(t,this.options.valueHandlers,y.globalValueHandlers))throw new Error("field value must be a string, number, boolean, null or one of the registered custom value types")}return t}},{key:"_escapeValue",value:function(t){return this.options.replaceSingleQuotes&&t?t.replace(/\'/g,this.options.singleQuoteReplacement):t}},{key:"_formatTableName",value:function(t){if(this.options.autoQuoteTableNames){var e=this.options.nameQuoteCharacter;t="".concat(e).concat(t).concat(e)}return t}},{key:"_formatFieldAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.fieldAliasQuoteCharacter;t="".concat(e).concat(t).concat(e)}return t}},{key:"_formatTableAlias",value:function(t){if(this.options.autoQuoteAliasNames){var e=this.options.tableAliasQuoteCharacter;t="".concat(e).concat(t).concat(e)}return this.options.useAsForTableAliasNames?"AS ".concat(t):t}},{key:"_formatFieldName",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(this.options.autoQuoteFieldNames){var n=this.options.nameQuoteCharacter;t=e.ignorePeriodsForFieldNameQuotes?"".concat(n).concat(t).concat(n):t.split(".").map(function(t){return"*"===t?t:"".concat(n).concat(t).concat(n)}).join(".")}return t}},{key:"_formatCustomValue",value:function(t,e,n){var i=f(t,this.options.valueHandlers,y.globalValueHandlers);return i&&(t=i(t,e,n))&&t.rawNesting?{formatted:!0,rawNesting:!0,value:t.value}:{formatted:!!i,value:t}}},{key:"_formatValueForParamArray",value:function(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return m(t)?t.map(function(t){return e._formatValueForParamArray(t,n)}):this._formatCustomValue(t,!0,n).value}},{key:"_formatValueForQueryString",value:function(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=this._formatCustomValue(t,!1,n),r=i.rawNesting,a=i.formatted,l=i.value;if(a)return r?l:this._applyNestingFormatting(l,s(t));if(m(l))l=l.map(function(t){return e._formatValueForQueryString(t)}),l=this._applyNestingFormatting(l.join(", "),s(l));else{var o=c(l);if(null===l)l="NULL";else if("boolean"===o)l=l?"TRUE":"FALSE";else if(y.isSquelBuilder(l))l=this._applyNestingFormatting(l.toString(),s(l));else if("number"!==o){if("string"===o&&this.options.stringFormatter)return this.options.stringFormatter(l);if(n.dontQuote)l="".concat(l);else{var u=this._escapeValue(l);l="'".concat(u,"'")}}}return l}},{key:"_applyNestingFormatting",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(t&&"string"==typeof t&&e&&!this.options.rawNesting){var n="("===t.charAt(0)&&")"===t.charAt(t.length-1);if(n)for(var i=0,r=1;t.length-1>++i;){var a=t.charAt(i);if("("===a)r++;else if(")"===a&&--r<1){n=!1;break}}n||(t="(".concat(t,")"))}return t}},{key:"_buildString",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=n.nested,r=n.buildParameterized,a=n.formattingOptions;e=e||[],t=t||"";for(var l="",o=-1,u=[],s=this.options.parameterCharacter,c=0;t.length>c;)if(t.substr(c,s.length)===s){var h=e[++o];if(r)if(y.isSquelBuilder(h)){var f=h._toParamString({buildParameterized:r,nested:!0});l+=f.text,f.values.forEach(function(t){return u.push(t)})}else if(m(h=this._formatValueForParamArray(h,a))){var v=h.map(function(){return s}).join(", ");l+="(".concat(v,")"),h.forEach(function(t){return u.push(t)})}else l+=s,u.push(h);else l+=this._formatValueForQueryString(h,a);c+=s.length}else l+=t.charAt(c),c++;return{text:this._applyNestingFormatting(l,!!i),values:u}}},{key:"_buildManyStrings",value:function(t,e){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=[],r=[],a=0;t.length>a;++a){var l=t[a],o=e[a],u=this._buildString(l,o,{buildParameterized:n.buildParameterized,nested:!1}),s=u.text,c=u.values;i.push(s),c.forEach(function(t){return r.push(t)})}return{text:(i=i.join(this.options.separator)).length?this._applyNestingFormatting(i,!!n.nested):"",values:r}}},{key:"_toParamString",value:function(t){throw new Error("Not yet implemented")}},{key:"toString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._toParamString(t).text}},{key:"toParam",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._toParamString(h({},t,{buildParameterized:!0}))}}]),i}(),y.Expression=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._nodes=[],e}return l(n,y.BaseBuilder),u(n,[{key:"and",value:function(t){t=this._sanitizeExpression(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this._nodes.push({type:"AND",expr:t,para:n}),this}},{key:"or",value:function(t){t=this._sanitizeExpression(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this._nodes.push({type:"OR",expr:t,para:n}),this}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=[],n=[],i=!0,r=!1,a=void 0;try{for(var l,o=this._nodes[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=l.value,s=u.type,c=u.expr,h=u.para,f=y.isSquelBuilder(c)?c._toParamString({buildParameterized:t.buildParameterized,nested:!0}):this._buildString(c,h,{buildParameterized:t.buildParameterized}),v=f.text,d=f.values;e.length&&e.push(s),e.push(v),d.forEach(function(t){return n.push(t)})}}catch(t){r=!0,a=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return e=e.join(" "),{text:this._applyNestingFormatting(e,!!t.nested),values:n}}}]),n}(),y.Case=function(t){function i(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _(this,i),e=v(this,p(i).call(this,n)),r(t)&&(n=t,t=null),t&&(e._fieldName=e._sanitizeField(t)),e.options=h({},y.DefaultQueryBuilderOptions,n),e._cases=[],e._elseValue=null,e}return l(i,y.BaseBuilder),u(i,[{key:"when",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this._cases.unshift({expression:t,values:n||[]}),this}},{key:"then",value:function(t){if(0==this._cases.length)throw new Error("when() needs to be called first");return this._cases[0].result=t,this}},{key:"else",value:function(t){return this._elseValue=t,this}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],i=!0,r=!1,a=void 0;try{for(var l,o=this._cases[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=l.value,s=u.expression,c=u.values,h=u.result;e=g(e," ");var f=this._buildString(s,c,{buildParameterized:t.buildParameterized,nested:!0});e+="WHEN ".concat(f.text," THEN ").concat(this._formatValueForQueryString(h)),f.values.forEach(function(t){return n.push(t)})}}catch(t){r=!0,a=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return{text:e=e.length?(e+=" ELSE ".concat(this._formatValueForQueryString(this._elseValue)," END"),this._fieldName&&(e="".concat(this._fieldName," ").concat(e)),"CASE ".concat(e)):this._formatValueForQueryString(this._elseValue),values:n}}}]),i}(),y.Block=function(t){function e(t){return _(this,e),v(this,p(e).call(this,t))}return l(e,y.BaseBuilder),u(e,[{key:"exposedMethods",value:function(){for(var e={},n=this;n;)Object.getOwnPropertyNames(n).forEach(function(t){"constructor"===t||"function"!=typeof n[t]||"_"===t.charAt(0)||y.Block.prototype[t]||(e[t]=n[t])}),n=Object.getPrototypeOf(n);return e}}]),e}(),y.StringBlock=function(t){function i(t,e){var n;return _(this,i),(n=v(this,p(i).call(this,t)))._str=e,n}return l(i,y.Block),u(i,[{key:"_toParamString",value:function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];return{text:this._str,values:[]}}}]),i}(),y.FunctionBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._strings=[],e._values=[],e}return l(n,y.Block),u(n,[{key:"function",value:function(t){this._strings.push(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this._values.push(n)}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._buildManyStrings(this._strings,this._values,t)}}]),n}(),y.registerValueHandler(y.FunctionBlock,function(t){return 1<arguments.length&&void 0!==arguments[1]&&arguments[1]?t.toParam():t.toString()}),y.AbstractTableBlock=function(t){function i(t,e){var n;return _(this,i),(n=v(this,p(i).call(this,t)))._tables=[],n}return l(i,y.Block),u(i,[{key:"_table",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;e=e?this._sanitizeTableAlias(e):e,t=this._sanitizeTable(t),this.options.singleTable&&(this._tables=[]),this._tables.push({table:t,alias:e})}},{key:"_hasTable",value:function(){return 0<this._tables.length}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[];if(this._hasTable()){var i=!0,r=!1,a=void 0;try{for(var l,o=this._tables[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=l.value,s=u.table,c=u.alias;e=g(e,", ");var h=void 0;if(y.isSquelBuilder(s)){var f=s._toParamString({buildParameterized:t.buildParameterized,nested:!0}),v=f.text,d=f.values;h=v,d.forEach(function(t){return n.push(t)})}else h=this._formatTableName(s);c&&(h+=" ".concat(this._formatTableAlias(c))),e+=h}}catch(t){r=!0,a=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}this.options.prefix&&(e="".concat(this.options.prefix," ").concat(e))}return{text:e,values:n}}}]),i}(),y.TargetTableBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,y.AbstractTableBlock),u(e,[{key:"target",value:function(t){this._table(t)}}]),e}(),y.UpdateTableBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,y.AbstractTableBlock),u(e,[{key:"table",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._table(t,e)}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this._hasTable())throw new Error("table() needs to be called");return o(p(e.prototype),"_toParamString",this).call(this,t)}}]),e}(),y.FromTableBlock=function(t){function e(t){return _(this,e),v(this,p(e).call(this,h({},t,{prefix:"FROM"})))}return l(e,y.AbstractTableBlock),u(e,[{key:"from",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._table(t,e)}}]),e}(),y.IntoTableBlock=function(t){function e(t){return _(this,e),v(this,p(e).call(this,h({},t,{prefix:"INTO",singleTable:!0})))}return l(e,y.AbstractTableBlock),u(e,[{key:"into",value:function(t){this._table(t)}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this._hasTable())throw new Error("into() needs to be called");return o(p(e.prototype),"_toParamString",this).call(this,t)}}]),e}(),y.GetFieldBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._fields=[],e}return l(n,y.Block),u(n,[{key:"fields",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(m(t)){var n=!0,i=!1,r=void 0;try{for(var a,l=t[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var o=a.value;this.field(o,null,e)}}catch(t){i=!0,r=t}finally{try{n||null==l.return||l.return()}finally{if(i)throw r}}}else for(var u in t){var s=t[u];this.field(u,s,e)}}},{key:"field",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(n=n?this._sanitizeFieldAlias(n):n,e=this._sanitizeField(e),this._fields.filter(function(t){return t.name===e&&t.alias===n}).length)return this;this._fields.push({name:e,alias:n,options:t})}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.queryBuilder,n=t.buildParameterized,i="",r=[],a=!0,l=!1,o=void 0;try{for(var u,s=this._fields[Symbol.iterator]();!(a=(u=s.next()).done);a=!0){var c=u.value;i=g(i,", ");var h=c.name,f=c.alias,v=c.options;if("string"==typeof h)i+=this._formatFieldName(h,v);else{var d=h._toParamString({nested:!0,buildParameterized:n});i+=d.text,d.values.forEach(function(t){return r.push(t)})}f&&(i+=" AS ".concat(this._formatFieldAlias(f)))}}catch(t){l=!0,o=t}finally{try{a||null==s.return||s.return()}finally{if(l)throw o}}if(!i.length){var p=e&&e.getBlock(y.FromTableBlock);p&&p._hasTable()&&(i="*")}return{text:i,values:r}}}]),n}(),y.AbstractSetFieldBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._reset(),e}return l(n,y.Block),u(n,[{key:"_reset",value:function(){this._fields=[],this._values=[[]],this._valueOptions=[[]]}},{key:"_set",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(1<this._values.length)throw new Error("Cannot set multiple rows of fields this way.");void 0!==e&&(e=this._sanitizeValue(e)),t=this._sanitizeField(t);var i=this._fields.indexOf(t);-1===i&&(this._fields.push(t),i=this._fields.length-1),this._values[0][i]=e,this._valueOptions[0][i]=n}},{key:"_setFields",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if("object"!==c(t))throw new Error("Expected an object but got "+c(t));for(var n in t)this._set(n,t[n],e)}},{key:"_setFieldsRows",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!m(t))throw new Error("Expected an array of objects but got "+c(t));this._reset();for(var n=0;t.length>n;++n){var i=t[n];for(var r in i){var a=i[r];r=this._sanitizeField(r),a=this._sanitizeValue(a);var l=this._fields.indexOf(r);if(0<n&&-1===l)throw new Error("All fields in subsequent rows must match the fields in the first row");-1===l&&(this._fields.push(r),l=this._fields.length-1),m(this._values[n])||(this._values[n]=[],this._valueOptions[n]=[]),this._values[n][l]=a,this._valueOptions[n][l]=e}}}}]),n}(),y.SetFieldBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,y.AbstractSetFieldBlock),u(e,[{key:"set",value:function(t,e,n){this._set(t,e,n)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"_toParamString",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).buildParameterized;if(this._fields.length<=0)throw new Error("set() needs to be called");for(var e="",n=[],i=0;i<this._fields.length;++i){e=g(e,", ");var r=this._formatFieldName(this._fields[i]),a=this._values[0][i];r.indexOf("=")<0&&(r="".concat(r," = ").concat(this.options.parameterCharacter));var l=this._buildString(r,[a],{buildParameterized:t,formattingOptions:this._valueOptions[0][i]});e+=l.text,l.values.forEach(function(t){return n.push(t)})}return{text:"SET ".concat(e),values:n}}}]),e}(),y.InsertFieldValueBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,y.AbstractSetFieldBlock),u(e,[{key:"set",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this._set(t,e,n)}},{key:"setFields",value:function(t,e){this._setFields(t,e)}},{key:"setFieldsRows",value:function(t,e){this._setFieldsRows(t,e)}},{key:"_toParamString",value:function(){for(var e=this,t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).buildParameterized,n=this._fields.map(function(t){return e._formatFieldName(t)}).join(", "),i=[],r=[],a=0;a<this._values.length;++a){i[a]="";for(var l=0;l<this._values[a].length;++l){var o=this._buildString(this.options.parameterCharacter,[this._values[a][l]],{buildParameterized:t,formattingOptions:this._valueOptions[a][l]});o.values.forEach(function(t){return r.push(t)}),i[a]=g(i[a],", "),i[a]+=o.text}}return{text:n.length?"(".concat(n,") VALUES (").concat(i.join("), ("),")"):"",values:r}}}]),e}(),y.InsertFieldsFromQueryBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._fields=[],e._query=null,e}return l(n,y.Block),u(n,[{key:"fromQuery",value:function(t,e){var n=this;this._fields=t.map(function(t){return n._sanitizeField(t)}),this._query=this._sanitizeBaseBuilder(e)}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[];if(this._fields.length&&this._query){var i=this._query._toParamString({buildParameterized:t.buildParameterized,nested:!0}),r=i.text,a=i.values;e="(".concat(this._fields.join(", "),") ").concat(this._applyNestingFormatting(r)),n=a}return{text:e,values:n}}}]),n}(),y.DistinctBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,y.Block),u(e,[{key:"distinct",value:function(){this._useDistinct=!0}},{key:"_toParamString",value:function(){return{text:this._useDistinct?"DISTINCT":"",values:[]}}}]),e}(),y.GroupByBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._groups=[],e}return l(n,y.Block),u(n,[{key:"group",value:function(t){this._groups.push(this._sanitizeField(t))}},{key:"_toParamString",value:function(){0<arguments.length&&void 0!==arguments[0]&&arguments[0];return{text:this._groups.length?"GROUP BY ".concat(this._groups.join(", ")):"",values:[]}}}]),n}(),y.AbstractVerbSingleValueBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._value=null,e}return l(n,y.Block),u(n,[{key:"_setValue",value:function(t){this._value=null!==t?this._sanitizeLimitOffset(t):t}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=null!==this._value?"".concat(this.options.verb," ").concat(this.options.parameterCharacter):"",n=null!==this._value?[this._value]:[];return this._buildString(e,n,t)}}]),n}(),y.OffsetBlock=function(t){function e(t){return _(this,e),v(this,p(e).call(this,h({},t,{verb:"OFFSET"})))}return l(e,y.AbstractVerbSingleValueBlock),u(e,[{key:"offset",value:function(t){this._setValue(t)}}]),e}(),y.LimitBlock=function(t){function e(t){return _(this,e),v(this,p(e).call(this,h({},t,{verb:"LIMIT"})))}return l(e,y.AbstractVerbSingleValueBlock),u(e,[{key:"limit",value:function(t){this._setValue(t)}}]),e}(),y.AbstractConditionBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._conditions=[],e}return l(n,y.Block),u(n,[{key:"_condition",value:function(t){t=this._sanitizeExpression(t);for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this._conditions.push({expr:t,values:n||[]})}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=[],n=[],i=!0,r=!1,a=void 0;try{for(var l,o=this._conditions[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=l.value,s=u.expr,c=u.values,h=y.isSquelBuilder(s)?s._toParamString({buildParameterized:t.buildParameterized}):this._buildString(s,c,{buildParameterized:t.buildParameterized});h.text.length&&e.push(h.text),h.values.forEach(function(t){return n.push(t)})}}catch(t){r=!0,a=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return e.length&&(e=e.join(") AND (")),{text:e.length?"".concat(this.options.verb," (").concat(e,")"):"",values:n}}}]),n}(),y.WhereBlock=function(t){function e(t){return _(this,e),v(this,p(e).call(this,h({},t,{verb:"WHERE"})))}return l(e,y.AbstractConditionBlock),u(e,[{key:"where",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this._condition.apply(this,[t].concat(n))}}]),e}(),y.HavingBlock=function(t){function e(t){return _(this,e),v(this,p(e).call(this,h({},t,{verb:"HAVING"})))}return l(e,y.AbstractConditionBlock),u(e,[{key:"having",value:function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this._condition.apply(this,[t].concat(n))}}]),e}(),y.OrderByBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._orders=[],e}return l(n,y.Block),u(n,[{key:"order",value:function(t,e){t=this._sanitizeField(t),"string"!=typeof e&&(void 0===e?e="ASC":null!==e&&(e=e?"ASC":"DESC"));for(var n=arguments.length,i=new Array(2<n?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];this._orders.push({field:t,dir:e,values:i||[]})}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],i=!0,r=!1,a=void 0;try{for(var l,o=this._orders[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=l.value,s=u.field,c=u.dir,h=u.values;e=g(e,", ");var f=this._buildString(s,h,{buildParameterized:t.buildParameterized});e+=f.text,m(f.values)&&f.values.forEach(function(t){return n.push(t)}),null!==c&&(e+=" ".concat(c))}}catch(t){r=!0,a=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return{text:e.length?"ORDER BY ".concat(e):"",values:n}}}]),n}(),y.JoinBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._joins=[],e}return l(n,y.Block),u(n,[{key:"join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"INNER";t=this._sanitizeTable(t,!0),e=e?this._sanitizeTableAlias(e):e,n=n?this._sanitizeExpression(n):n,this._joins.push({type:i,table:t,alias:e,condition:n})}},{key:"left_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"LEFT")}},{key:"right_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"RIGHT")}},{key:"outer_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"OUTER")}},{key:"left_outer_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"LEFT OUTER")}},{key:"full_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"FULL")}},{key:"cross_join",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.join(t,e,n,"CROSS")}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],i=!0,r=!1,a=void 0;try{for(var l,o=this._joins[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=l.value,s=u.type,c=u.table,h=u.alias,f=u.condition;e=g(e,this.options.separator);var v=void 0;if(y.isSquelBuilder(c)){var d=c._toParamString({buildParameterized:t.buildParameterized,nested:!0});d.values.forEach(function(t){return n.push(t)}),v=d.text}else v=this._formatTableName(c);if(e+="".concat(s," JOIN ").concat(v),h&&(e+=" ".concat(this._formatTableAlias(h))),f){e+=" ON ";var p=void 0;p=y.isSquelBuilder(f)?f._toParamString({buildParameterized:t.buildParameterized}):this._buildString(f,[],{buildParameterized:t.buildParameterized}),e+=this._applyNestingFormatting(p.text),p.values.forEach(function(t){return n.push(t)})}}}catch(t){r=!0,a=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return{text:e,values:n}}}]),n}(),y.LockBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,y.Block),u(e,[{key:"forLocking",value:function(t){this.lock_level=t}},{key:"_toParamString",value:function(){return{text:this.lock_level?"FOR ".concat(this.lock_level):"",values:[]}}}]),e}(),y.SetOpBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._sets=[],e}return l(n,y.Block),u(n,[{key:"_add",value:function(t,e){t=this._sanitizeTable(t),this._sets.push({type:e,table:t})}},{key:"union",value:function(t){this._add(t,"UNION")}},{key:"union_all",value:function(t){this._add(t,"UNION ALL")}},{key:"intersect",value:function(t){this._add(t,"INTERSECT")}},{key:"intersect_all",value:function(t){this._add(t,"INTERSECT ALL")}},{key:"except",value:function(t){this._add(t,"EXCEPT")}},{key:"except_all",value:function(t){this._add(t,"EXCEPT ALL")}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],i=!0,r=!1,a=void 0;try{for(var l,o=this._sets[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=l.value,s=u.type,c=u.table;e=g(e,this.options.separator);var h=void 0;if(c instanceof y.BaseBuilder){var f=c._toParamString({buildParameterized:t.buildParameterized,nested:!0});h=f.text,f.values.forEach(function(t){return n.push(t)})}else e=this._formatTableName(c);e+="".concat(s," ").concat(h)}}catch(t){r=!0,a=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return{text:e,values:n}}}]),n}(),y.QueryBuilder=function(t){function f(t,e){var a;_(this,f),(a=v(this,p(f).call(this,t))).blocks=e||[];var n=!0,i=!1,r=void 0;try{for(var l,o=a.blocks[Symbol.iterator]();!(n=(l=o.next()).done);n=!0){var u=l.value,s=u.exposedMethods();for(var c in s){var h=s[c];if(void 0!==a[c])throw new Error("Builder already has a builder method called: ".concat(c));!function(i,t,r){a[c]=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return r.call.apply(r,[i].concat(e)),d(a)}}(u,0,h)}}}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}return l(f,y.BaseBuilder),u(f,[{key:"registerValueHandler",value:function(t,e){var n=!0,i=!1,r=void 0;try{for(var a,l=this.blocks[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){a.value.registerValueHandler(t,e)}}catch(t){i=!0,r=t}finally{try{n||null==l.return||l.return()}finally{if(i)throw r}}return o(p(f.prototype),"registerValueHandler",this).call(this,t,e),this}},{key:"updateOptions",value:function(t){this.options=h({},this.options,t);var e=!0,n=!1,i=void 0;try{for(var r,a=this.blocks[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var l=r.value;l.options=h({},l.options,t)}}catch(t){n=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"_toParamString",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};n=h({},this.options,n);var t=this.blocks.map(function(t){return t._toParamString({buildParameterized:n.buildParameterized,queryBuilder:e})}),i=t.map(function(t){return t.text}),r=t.map(function(t){return t.values}),a=i.filter(function(t){return 0<t.length}).join(n.separator),l=[];if(r.forEach(function(t){return t.forEach(function(t){return l.push(t)})}),!n.nested&&n.numberedParameters){var o=void 0!==n.numberedParametersStartAt?n.numberedParametersStartAt:1,u=n.parameterCharacter.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");a=a.replace(new RegExp(u,"g"),function(){return"".concat(n.numberedParametersPrefix).concat(o++)})}return{text:this._applyNestingFormatting(a,!!n.nested),values:l}}},{key:"clone",value:function(){var t=this.blocks.map(function(t){return t.clone()});return new this.constructor(this.options,t)}},{key:"getBlock",value:function(e){return this.blocks.filter(function(t){return t instanceof e})[0]}}]),f}(),y.Select=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new y.StringBlock(t,"SELECT"),new y.FunctionBlock(t),new y.DistinctBlock(t),new y.GetFieldBlock(t),new y.FromTableBlock(t),new y.JoinBlock(t),new y.WhereBlock(t),new y.GroupByBlock(t),new y.HavingBlock(t),new y.OrderByBlock(t),new y.LimitBlock(t),new y.OffsetBlock(t),new y.LockBlock(t),new y.SetOpBlock(t)],v(this,p(n).call(this,t,e))}return l(n,y.QueryBuilder),n}(),y.Update=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new y.StringBlock(t,"UPDATE"),new y.UpdateTableBlock(t),new y.SetFieldBlock(t),new y.WhereBlock(t),new y.OrderByBlock(t),new y.LimitBlock(t)],v(this,p(n).call(this,t,e))}return l(n,y.QueryBuilder),n}(),y.Delete=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new y.StringBlock(t,"DELETE"),new y.TargetTableBlock(t),new y.FromTableBlock(h({},t,{singleTable:!0})),new y.JoinBlock(t),new y.WhereBlock(t),new y.OrderByBlock(t),new y.LimitBlock(t)],v(this,p(n).call(this,t,e))}return l(n,y.QueryBuilder),n}(),y.Insert=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new y.StringBlock(t,"INSERT"),new y.IntoTableBlock(t),new y.InsertFieldValueBlock(t),new y.InsertFieldsFromQueryBlock(t)],v(this,p(n).call(this,t,e))}return l(n,y.QueryBuilder),n}();var e={VERSION:"5.14.0",flavour:t,expr:function(t){return new y.Expression(t)},case:function(t,e){return new y.Case(t,e)},select:function(t,e){return new y.Select(t,e)},update:function(t,e){return new y.Update(t,e)},insert:function(t,e){return new y.Insert(t,e)},delete:function(t,e){return new y.Delete(t,e)},str:function(){var t=new y.FunctionBlock;return t.function.apply(t,arguments),t},rstr:function(){var t=new y.FunctionBlock({rawNesting:!0});return t.function.apply(t,arguments),t},registerValueHandler:y.registerValueHandler};return e.remove=e.delete,e.cls=y,e}var k=y();return k.flavours={},k.useFlavour=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(!t)return k;if(k.flavours[t]instanceof Function){var e=y(t);return k.flavours[t].call(null,e),e.flavours=k.flavours,e.useFlavour=k.useFlavour,e}throw new Error("Flavour not available: ".concat(t))},k.flavours.mssql=function(t){var a=t.cls;a.DefaultQueryBuilderOptions.replaceSingleQuotes=!0,a.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,a.DefaultQueryBuilderOptions.numberedParametersPrefix="@",t.registerValueHandler(Date,function(t){return"'".concat(t.getUTCFullYear(),"-").concat(t.getUTCMonth()+1,"-").concat(t.getUTCDate()," ").concat(t.getUTCHours(),":").concat(t.getUTCMinutes(),":").concat(t.getUTCSeconds(),"'")}),a.MssqlLimitOffsetTopBlock=function(t){function e(t){var i;_(this,e),(i=v(this,p(e).call(this,t)))._limits=null,i._offsets=null;var r=function(t){t=this._sanitizeLimitOffset(t),this._parent._limits=t};return i.ParentBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t.options)))._parent=t,e}return l(n,a.Block),n}(),i.LimitBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t))).limit=r,e}return l(n,i.ParentBlock),u(n,[{key:"_toParamString",value:function(){var t="";return this._parent._limits&&this._parent._offsets&&(t="FETCH NEXT ".concat(this._parent._limits," ROWS ONLY")),{text:t,values:[]}}}]),n}(),i.TopBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t))).top=r,e}return l(n,i.ParentBlock),u(n,[{key:"_toParamString",value:function(){var t="";return this._parent._limits&&!this._parent._offsets&&(t="TOP (".concat(this._parent._limits,")")),{text:t,values:[]}}}]),n}(),i.OffsetBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,i.ParentBlock),u(e,[{key:"offset",value:function(t){this._parent._offsets=this._sanitizeLimitOffset(t)}},{key:"_toParamString",value:function(){var t="";return this._parent._offsets&&(t="OFFSET ".concat(this._parent._offsets," ROWS")),{text:t,values:[]}}}]),e}(),i}return l(e,a.Block),u(e,[{key:"LIMIT",value:function(){return new this.LimitBlock(this)}},{key:"TOP",value:function(){return new this.TopBlock(this)}},{key:"OFFSET",value:function(){return new this.OffsetBlock(this)}}]),e}(),a.MssqlUpdateTopBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._limits=null,e.limit=e.top=function(t){e._limits=e._sanitizeLimitOffset(t)},e}return l(n,a.Block),u(n,[{key:"_toParamString",value:function(){return{text:this._limits?"TOP (".concat(this._limits,")"):"",values:[]}}}]),n}(),a.MssqlInsertFieldValueBlock=function(t){function r(t){var e;return _(this,r),(e=v(this,p(r).call(this,t)))._outputs=[],e}return l(r,a.InsertFieldValueBlock),u(r,[{key:"output",value:function(t){var e=this;"string"==typeof t?this._outputs.push("INSERTED.".concat(this._sanitizeField(t))):t.forEach(function(t){e._outputs.push("INSERTED.".concat(e._sanitizeField(t)))})}},{key:"_toParamString",value:function(t){var e=o(p(r.prototype),"_toParamString",this).call(this,t);if(e.text.length&&0<this._outputs.length){var n="OUTPUT ".concat(this._outputs.join(", ")," "),i=e.text.indexOf("VALUES");e.text=e.text.substr(0,i)+n+e.text.substr(i)}return e}}]),r}(),a.MssqlUpdateDeleteOutputBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._outputs=[],e}return l(n,a.Block),u(n,[{key:"outputs",value:function(t){for(var e in t)this.output(e,t[e])}},{key:"output",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;t=this._sanitizeField(t),e=e?this._sanitizeFieldAlias(e):e,this._outputs.push({name:this.options.forDelete?"DELETED.".concat(t):"INSERTED.".concat(t),alias:e})}},{key:"_toParamString",value:function(t){var e="";if(this._outputs.length){var n=!0,i=!1,r=void 0;try{for(var a,l=this._outputs[Symbol.iterator]();!(n=(a=l.next()).done);n=!0){var o=a.value;e=g(e,", "),e+=o.name,o.alias&&(e+=" AS ".concat(this._formatFieldAlias(o.alias)))}}catch(t){i=!0,r=t}finally{try{n||null==l.return||l.return()}finally{if(i)throw r}}e="OUTPUT ".concat(e)}return{text:e,values:[]}}}]),n}(),a.Select=function(t){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_(this,i);var n=new a.MssqlLimitOffsetTopBlock(t);return e=e||[new a.StringBlock(t,"SELECT"),new a.DistinctBlock(t),n.TOP(),new a.GetFieldBlock(t),new a.FromTableBlock(t),new a.JoinBlock(t),new a.WhereBlock(t),new a.GroupByBlock(t),new a.OrderByBlock(t),n.OFFSET(),n.LIMIT(),new a.SetOpBlock(t)],v(this,p(i).call(this,t,e))}return l(i,a.QueryBuilder),i}(),a.Update=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new a.StringBlock(t,"UPDATE"),new a.MssqlUpdateTopBlock(t),new a.UpdateTableBlock(t),new a.SetFieldBlock(t),new a.MssqlUpdateDeleteOutputBlock(t),new a.WhereBlock(t)],v(this,p(n).call(this,t,e))}return l(n,a.QueryBuilder),n}(),a.Delete=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new a.StringBlock(t,"DELETE"),new a.TargetTableBlock(t),new a.FromTableBlock(h({},t,{singleTable:!0})),new a.JoinBlock(t),new a.MssqlUpdateDeleteOutputBlock(h({},t,{forDelete:!0})),new a.WhereBlock(t),new a.OrderByBlock(t),new a.LimitBlock(t)],v(this,p(n).call(this,t,e))}return l(n,a.QueryBuilder),n}(),a.Insert=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new a.StringBlock(t,"INSERT"),new a.IntoTableBlock(t),new a.MssqlInsertFieldValueBlock(t),new a.InsertFieldsFromQueryBlock(t)],v(this,p(n).call(this,t,e))}return l(n,a.QueryBuilder),n}()},k.flavours.mysql=function(t){var i=t.cls;i.MysqlOnDuplicateKeyUpdateBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,i.AbstractSetFieldBlock),u(e,[{key:"onDupUpdate",value:function(t,e,n){this._set(t,e,n)}},{key:"_toParamString",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],i=0;i<this._fields.length;++i){e=g(e,", ");var r=this._fields[i],a=this._values[0][i],l=this._valueOptions[0][i];if(void 0===a)e+=r;else{var o=this._buildString("".concat(r," = ").concat(this.options.parameterCharacter),[a],{buildParameterized:t.buildParameterized,formattingOptions:l});e+=o.text,o.values.forEach(function(t){return n.push(t)})}}return{text:e.length?"ON DUPLICATE KEY UPDATE ".concat(e):"",values:n}}}]),e}(),i.Insert=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new i.StringBlock(t,"INSERT"),new i.IntoTableBlock(t),new i.InsertFieldValueBlock(t),new i.InsertFieldsFromQueryBlock(t),new i.MysqlOnDuplicateKeyUpdateBlock(t)],v(this,p(n).call(this,t,e))}return l(n,i.QueryBuilder),n}(),i.Replace=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new i.StringBlock(t,"REPLACE"),new i.IntoTableBlock(t),new i.InsertFieldValueBlock(t),new i.InsertFieldsFromQueryBlock(t)],v(this,p(n).call(this,t,e))}return l(n,i.QueryBuilder),n}(),t.replace=function(t,e){return new i.Replace(t,e)}},k.flavours.postgres=function(t){var i=t.cls;i.DefaultQueryBuilderOptions.numberedParameters=!0,i.DefaultQueryBuilderOptions.numberedParametersStartAt=1,i.DefaultQueryBuilderOptions.autoQuoteAliasNames=!1,i.DefaultQueryBuilderOptions.useAsForTableAliasNames=!0,i.DefaultQueryBuilderOptions.nameQuoteCharacter='"',i.DefaultQueryBuilderOptions.tableAliasQuoteCharacter='"',i.PostgresOnConflictKeyUpdateBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,i.AbstractSetFieldBlock),u(e,[{key:"onConflict",value:function(t,e){var n=this;this._onConflict=!0,t&&(m(t)||(t=[t]),this._dupFields=t.map(this._sanitizeField.bind(this)),e&&Object.keys(e).forEach(function(t){n._set(t,e[t])}))}},{key:"_toParamString",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e="",n=[],i=0;i<this._fields.length;++i){e=g(e,", ");var r=this._fields[i],a=this._values[0][i],l=this._valueOptions[0][i];if(void 0===a)e+=r;else{var o=this._buildString("".concat(r," = ").concat(this.options.parameterCharacter),[a],{buildParameterized:t.buildParameterized,formattingOptions:l});e+=o.text,o.values.forEach(function(t){return n.push(t)})}}var u={text:"",values:n};if(this._onConflict){var s=this._dupFields?"(".concat(this._dupFields.join(", "),") "):"",c=e.length?"UPDATE SET ".concat(e):"NOTHING";u.text="ON CONFLICT ".concat(s,"DO ").concat(c)}return u}}]),e}(),i.ReturningBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._fields=[],e}return l(n,i.Block),u(n,[{key:"returning",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(n=n?this._sanitizeFieldAlias(n):n,e=this._sanitizeField(e),this._fields.filter(function(t){return t.name===e&&t.alias===n}).length)return this;this._fields.push({name:e,alias:n,options:t})}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(t.queryBuilder,t.buildParameterized),n="",i=[],r=!0,a=!1,l=void 0;try{for(var o,u=this._fields[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var s=o.value;n=g(n,", ");var c=s.name,h=s.alias,f=s.options;if("string"==typeof c)n+=this._formatFieldName(c,f);else{var v=c._toParamString({nested:!0,buildParameterized:e});n+=v.text,v.values.forEach(function(t){return i.push(t)})}h&&(n+=" AS ".concat(this._formatFieldAlias(h)))}}catch(t){a=!0,l=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw l}}return{text:0<n.length?"RETURNING ".concat(n):"",values:i}}}]),n}(),i.WithBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._tables=[],e}return l(n,i.Block),u(n,[{key:"with",value:function(t,e){this._tables.push({alias:t,table:e})}},{key:"_toParamString",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=[],n=[],i=!0,r=!1,a=void 0;try{for(var l,o=this._tables[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=l.value,s=u.alias,c=u.table._toParamString({buildParameterized:t.buildParameterized,nested:!0});e.push("".concat(s," AS ").concat(c.text)),c.values.forEach(function(t){return n.push(t)})}}catch(t){r=!0,a=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return{text:e.length?"WITH ".concat(e.join(", ")):"",values:n}}}]),n}(),i.WithValuesBlock=function(t){function e(){return _(this,e),v(this,p(e).apply(this,arguments))}return l(e,i.AbstractSetFieldBlock),u(e,[{key:"withValues",value:function(t,e){this._alias=t,this._setFieldsRows(e)}},{key:"_toParamString",value:function(){for(var e=this,t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).buildParameterized,n=this._fields.map(function(t){return e._formatFieldName(t)}).join(", "),i=[],r=[],a=0;a<this._values.length;++a){i[a]="";for(var l=0;l<this._values[a].length;++l){var o=this._buildString(this.options.parameterCharacter,[this._values[a][l]],{buildParameterized:t,formattingOptions:this._valueOptions[a][l]});o.values.forEach(function(t){return r.push(t)}),i[a]=g(i[a],", "),i[a]+=o.text}}return{text:n.length?"WITH ".concat(this._alias,"(").concat(n,") AS ( VALUES (").concat(i.join("), ("),") )"):"",values:r}}}]),e}(),i.DistinctOnBlock=function(t){function n(t){var e;return _(this,n),(e=v(this,p(n).call(this,t)))._distinctFields=[],e}return l(n,i.Block),u(n,[{key:"distinct",value:function(){var e=this;this._useDistinct=!0;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];n.forEach(function(t){e._distinctFields.push(e._sanitizeField(t))})}},{key:"_toParamString",value:function(){var t="";return this._useDistinct&&(t="DISTINCT",this._distinctFields.length&&(t+=" ON (".concat(this._distinctFields.join(", "),")"))),{text:t,values:[]}}}]),n}(),i.Select=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new i.WithBlock(t),new i.WithValuesBlock(t),new i.StringBlock(t,"SELECT"),new i.FunctionBlock(t),new i.DistinctOnBlock(t),new i.GetFieldBlock(t),new i.FromTableBlock(t),new i.JoinBlock(t),new i.WhereBlock(t),new i.GroupByBlock(t),new i.HavingBlock(t),new i.OrderByBlock(t),new i.LimitBlock(t),new i.OffsetBlock(t),new i.SetOpBlock(t)],v(this,p(n).call(this,t,e))}return l(n,i.QueryBuilder),n}(),i.Insert=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new i.WithBlock(t),new i.StringBlock(t,"INSERT"),new i.IntoTableBlock(t),new i.InsertFieldValueBlock(t),new i.InsertFieldsFromQueryBlock(t),new i.PostgresOnConflictKeyUpdateBlock(t),new i.ReturningBlock(t)],v(this,p(n).call(this,t,e))}return l(n,i.QueryBuilder),n}(),i.Update=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new i.WithBlock(t),new i.WithValuesBlock(t),new i.StringBlock(t,"UPDATE"),new i.UpdateTableBlock(t),new i.SetFieldBlock(t),new i.FromTableBlock(t),new i.WhereBlock(t),new i.OrderByBlock(t),new i.LimitBlock(t),new i.ReturningBlock(t)],v(this,p(n).call(this,t,e))}return l(n,i.QueryBuilder),n}(),i.Delete=function(t){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return _(this,n),e=e||[new i.WithBlock(t),new i.StringBlock(t,"DELETE"),new i.TargetTableBlock(t),new i.FromTableBlock(h({},t,{singleTable:!0})),new i.JoinBlock(t),new i.WhereBlock(t),new i.OrderByBlock(t),new i.LimitBlock(t),new i.ReturningBlock(t)],v(this,p(n).call(this,t,e))}return l(n,i.QueryBuilder),n}()},k});